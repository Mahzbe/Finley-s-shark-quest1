<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finley's Shark Quest</title>
    <style>
        body { margin: 0; }
        #game-canvas { border: 1px solid black; }
        #start-menu, #game-over-screen { text-align: center; margin-top: 20px; }
        #game-over-screen { display: none; }
        #puzzle-container { position: relative; }
        .block { width: 50px; height: 50px; display: inline-block; }
    </style>
</head>
<body>
    <canvas id="game-canvas" width="800" height="600"></canvas>
    <div id="start-menu">
        <h1>Finley's Shark Quest</h1>
        <button id="start-button" onclick="startGame()">Start Game</button>
    </div>
    <div id="game-over-screen">
        <h1>Game Over!</h1>
        <p>Your score: <span id="final-score"></span></p>
        <button id="restart-button" onclick="restartGame()">Restart</button>
    </div>
    <div id="puzzle-container">
        <div id="puzzle-grid"></div>
        <div id="move-counter">Moves left: <span id="moves-left">7</span></div>
    </div>
    <script>
        let game = {
            level: 0,
            puzzle: {
                puzzlePieces: [],
                sharkBehavior: {
                    speed: 1,
                    aggression: 1
                }
            },
            shark: {
                speed: 1,
                aggression: 1,
                x: 650,
                y: 100,
                width: 50,
                height: 50
            },
            finley: {
                x: 50,
                y: 50,
                width: 50,
                height: 50
            },
            score: 0,
            puzzleGrid: Array.from({ length: 4 }, () => Array(4).fill(null)),
            movesLeft: 7,
            puzzleSolved: false
        };

        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const puzzleContainer = document.getElementById('puzzle-grid');
        const movesLeftElem = document.getElementById('moves-left');

        function startGame() {
            document.getElementById('start-menu').style.display = 'none';
            document.getElementById('game-canvas').style.display = 'block';
            document.getElementById('game-over-screen').style.display = 'none';
            generatePuzzle();
            gameLoop();
        }

        function restartGame() {
            game = {
                level: 0,
                puzzle: {
                    puzzlePieces: [],
                    sharkBehavior: {
                        speed: 1,
                        aggression: 1
                    }
                },
                shark: {
                    speed: 1,
                    aggression: 1,
                    x: 650,
                    y: 100,
                    width: 50,
                    height: 50
                },
                finley: {
                    x: 50,
                    y: 50,
                    width: 50,
                    height: 50
                },
                score: 0,
                puzzleGrid: Array.from({ length: 4 }, () => Array(4).fill(null)),
                movesLeft: 7,
                puzzleSolved: false
            };
            document.getElementById('game-over-screen').style.display = 'none';
            document.getElementById('game-canvas').style.display = 'block';
            generatePuzzle();
            gameLoop();
        }

        function generatePuzzle() {
            const colors = ['red', 'green', 'blue', 'yellow'];
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    game.puzzleGrid[i][j] = colors[Math.floor(Math.random() * colors.length)];
                }
            }
            renderPuzzle();
        }

        function renderPuzzle() {
            puzzleContainer.innerHTML = '';
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    const block = document.createElement('div');
                    block.className = 'block';
                    block.style.backgroundColor = game.puzzleGrid[i][j];
                    block.style.left = `${j * 50}px`;
                    block.style.top = `${i * 50}px`;
                    block.style.position = 'absolute';
                    block.addEventListener('click', () => handleBlockClick(i, j));
                    puzzleContainer.appendChild(block);
                }
            }
        }

        function handleBlockClick(row, col) {
            if (game.movesLeft <= 0 || game.puzzleSolved) return;

            game.movesLeft--;
            movesLeftElem.textContent = game.movesLeft;

            // Perform matching logic here
            if (matchBlocks(row, col)) {
                renderPuzzle();
                if (checkPuzzleSolved()) {
                    game.puzzleSolved = true;
                    endGame();
                }
            } else if (game.movesLeft <= 0) {
                gameOver();
            }
        }

        function matchBlocks(row, col) {
            // Matching logic here (simplified)
            const color = game.puzzleGrid[row][col];
            let matched = 0;

            // Horizontal match
            for (let i = 0; i < 4; i++) {
                if (game.puzzleGrid[row][i] === color) {
                    matched++;
                } else {
                    matched = 0;
                }
                if (matched >= 3) return true;
            }

            // Vertical match
            matched = 0;
            for (let i = 0; i < 4; i++) {
                if (game.puzzleGrid[i][col] === color) {
                    matched++;
                } else {
                    matched = 0;
                }
                if (matched >= 3) return true;
            }

            return false;
        }

        function checkPuzzleSolved() {
            const matches = 0;
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    if (matchBlocks(i, j)) {
                        return true;
                    }
                }
            }
            return matches >= 5;
        }

        function updateSharkPosition() {
            const dx = game.finley.x - game.shark.x;
            const dy = game.finley.y - game.shark.y;
            const distance = Math.sqrt(dx * dx + dy * dy);

            if (distance > 0) {
                const moveX = (dx / distance) * game.shark.speed;
                const moveY = (dy / distance) * game.shark.speed;

                game.shark.x += moveX;
                game.shark.y += moveY;

                game.shark.x = Math.max(0, Math.min(750, game.shark.x));
                game.shark.y = Math.max(0, Math.min(550, game.shark.y));

                document.getElementById('shark').style.left = game.shark.x + 'px';
                document.getElementById('shark').style.top = game.shark.y + 'px';
            }
        }

        function updateFinleyPosition() {
            const dx = game.shark.x - game.finley.x;
            const dy = game.shark.y - game.finley.y;
            const distance = Math.sqrt(dx * dx + dy * dy);

            if (distance > 0) {
                const moveX = (dx / distance) * -2;
                const moveY = (dy / distance) * -2;

                game.finley.x += moveX;
                game.finley.y += moveY;

                game.finley.x = Math.max(0, Math.min(750, game.finley.x));
                game.finley.y = Math.max(0, Math.min(550, game.finley.y));

                document.getElementById('finley').style.left = game.finley.x + 'px';
                document.getElementById('finley').style.top = game.finley.y + 'px';
            }
        }

        function gameLoop() {
            if (!game.puzzleSolved) {
                updateSharkPosition();
                updateFinleyPosition();
                checkCollisions();
                requestAnimationFrame(gameLoop);
            }
        }

        function checkCollisions() {
            if (checkCollision(game.finley, game.shark)) {
                if (game.movesLeft <= 0) {
                    endGame();
                } else {
                    gameOver();
                }
            }
        }

        function checkCollision(object1, object2) {
            if (object1.x < object2.x + object2.width &&
                object1.x + object1.width > object2.x &&
                object1.y < object2.y + object2.height &&
                object1.y + object1.height > object2.y) {
                return true;
            }
            return false;
        }

        function endGame() {
            alert("Congratulations! You solved the puzzle.");
            document.getElementById('game-canvas').style.display = 'none';
            document.getElementById('game-over-screen').style.display = 'block';
            document.getElementById('final-score').textContent = game.score;
        }

        function gameOver() {
            alert("Game Over!");
            document.getElementById('game-canvas').style.display = 'none';
            document.getElementById('game-over-screen').style.display = 'block';
            document.getElementById('final-score').textContent = game.score;
        }
    </script>
</body>
</html>
