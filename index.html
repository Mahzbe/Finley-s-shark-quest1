<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finley's Shark Quest</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #game-canvas {
            background-color: lightblue;
            margin-bottom: 20px;
        }
        #puzzle-grid {
            display: grid;
            grid-template-columns: repeat(4, 50px);
            grid-template-rows: repeat(4, 50px);
            gap: 5px;
        }
        .puzzle-block {
            width: 50px;
            height: 50px;
            background-color: gray;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            color: white;
            cursor: pointer;
        }
        #move-counter, #match-counter {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <canvas id="game-canvas" width="500" height="300"></canvas>
    <div id="move-counter">Moves Left: 7</div>
    <div id="match-counter">Matches: 0</div>
    <div id="puzzle-grid"></div>
    <div id="game-over-screen" style="display: none;">
        <h1>Game Over!</h1>
        <button id="restart-button" onclick="restartGame()">Restart</button>
    </div>
    <div id="game-won-screen" style="display: none;">
        <h1>You Won!</h1>
        <button id="restart-button" onclick="restartGame()">Restart</button>
    </div>
    <script>
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');

        const grid = document.getElementById('puzzle-grid');
        const moveCounter = document.getElementById('move-counter');
        const matchCounter = document.getElementById('match-counter');
        let movesLeft = 7;
        let matches = 0;
        let puzzleGrid = [];
        const colors = ['red', 'green', 'blue', 'yellow'];

        const game = {
            shark: { x: 450, y: 150, width: 50, height: 50, speed: 2 },
            finley: { x: 50, y: 150, width: 50, height: 50, speed: 2 },
            gameOver: false
        };

        function initializeGrid() {
            grid.innerHTML = '';
            puzzleGrid = [];
            for (let i = 0; i < 4; i++) {
                const row = [];
                for (let j = 0; j < 4; j++) {
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    const block = document.createElement('div');
                    block.className = 'puzzle-block';
                    block.style.backgroundColor = color;
                    block.addEventListener('click', () => handleBlockClick(i, j));
                    grid.appendChild(block);
                    row.push(color);
                }
                puzzleGrid.push(row);
            }
        }

        function handleBlockClick(row, col) {
            if (game.gameOver) return;

            movesLeft--;
            moveCounter.textContent = `Moves Left: ${movesLeft}`;

            if (movesLeft === 0) {
                game.gameOver = true;
                gameOver();
                return;
            }

            checkMatches();

            if (matches >= 5) {
                gameWon();
            }
        }

        function checkMatches() {
            let foundMatch = false;
            // Check horizontal matches
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 2; j++) {
                    if (puzzleGrid[i][j] === puzzleGrid[i][j + 1] && puzzleGrid[i][j] === puzzleGrid[i][j + 2]) {
                        puzzleGrid[i][j] = puzzleGrid[i][j + 1] = puzzleGrid[i][j + 2] = null;
                        foundMatch = true;
                        matches++;
                        matchCounter.textContent = `Matches: ${matches}`;
                    }
                }
            }
            // Check vertical matches
            for (let j = 0; j < 4; j++) {
                for (let i = 0; i < 2; i++) {
                    if (puzzleGrid[i][j] === puzzleGrid[i + 1][j] && puzzleGrid[i][j] === puzzleGrid[i + 2][j]) {
                        puzzleGrid[i][j] = puzzleGrid[i + 1][j] = puzzleGrid[i + 2][j] = null;
                        foundMatch = true;
                        matches++;
                        matchCounter.textContent = `Matches: ${matches}`;
                    }
                }
            }

            if (foundMatch) {
                fillEmptySpaces();
            }
        }

        function fillEmptySpaces() {
            for (let i = 3; i >= 0; i--) {
                for (let j = 0; j < 4; j++) {
                    if (puzzleGrid[i][j] === null) {
                        puzzleGrid[i][j] = colors[Math.floor(Math.random() * colors.length)];
                    }
                }
            }
            renderGrid();
        }

        function renderGrid() {
            const blocks = grid.children;
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    const block = blocks[i * 4 + j];
                    block.style.backgroundColor = puzzleGrid[i][j];
                }
            }
        }

        function update() {
            if (game.gameOver) return;

            // Move Finley
            if (game.finley.x <= 50 && game.finley.y > 50) {
                game.finley.y -= game.finley.speed;
            } else if (game.finley.y <= 50 && game.finley.x < 450) {
                game.finley.x += game.finley.speed;
            } else if (game.finley.x >= 450 && game.finley.y < 250) {
                game.finley.y += game.finley.speed;
            } else if (game.finley.y >= 250 && game.finley.x > 50) {
                game.finley.x -= game.finley.speed;
            }

            // Move Shark
            const dx = game.finley.x - game.shark.x;
            const dy = game.finley.y - game.shark.y;
            const distance = Math.sqrt(dx * dx + dy * dy);

            game.shark.x += (dx / distance) * game.shark.speed;
            game.shark.y += (dy / distance) * game.shark.speed;

            if (distance < 50 && movesLeft === 0) {
                gameOver();
            }
        }

        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'green';
            ctx.fillRect(game.finley.x, game.finley.y, game.finley.width, game.finley.height);
            ctx.fillStyle = 'red';
            ctx.fillRect(game.shark.x, game.shark.y, game.shark.width, game.shark.height);
        }

        function gameLoop() {
            update();
            render();
            requestAnimationFrame(gameLoop);
        }

        function gameOver() {
            game.gameOver = true;
            document.getElementById('game-over-screen').style.display = 'block';
        }

        function gameWon() {
            game.gameOver = true;
            document.getElementById('game-won-screen').style.display = 'block';
        }

        function restartGame() {
            game.gameOver = false;
            movesLeft = 7;
            matches = 0;
            game.finley.x = 50;
            game.finley.y = 150;
            game.shark.x = 450;
            game.shark.y = 150;
            moveCounter.textContent = `Moves Left: ${movesLeft}`;
            matchCounter.textContent = `Matches: ${matches}`;
            document.getElementById('game-over-screen').style.display = 'none';
            document.getElementById('game-won-screen').style.display = 'none';
            initializeGrid();
            gameLoop();
        }

        initializeGrid();
        gameLoop();
    </script>
</body>
</html>
